<!-- src/main/resources/templates/users/form.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="${title}">Member Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-label { font-weight: 500; }
    </style>
</head>
<body class="bg-light">
<div class="d-flex min-vh-100">

     <aside class="bg-white border-end shadow-sm d-flex flex-column" style="width: 250px;">
        <div class="p-4">
            <h4 class="fw-bold mb-4 text-primary">Readly</h4>
            <nav class="nav flex-column">
                <a class="nav-link active fw-medium" th:href="@{/dashboard}">
                    <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                </a>
                <a class="nav-link" th:href="@{/admin/books}">
                    <i class="fas fa-book me-2"></i> Manage Books
                </a>
                <a class="nav-link" th:href="@{/admin/books/new}">
                    <i class="fas fa-plus-circle me-2"></i> Add Book
                </a>
                <a class="nav-link" th:href="@{/admin/users}">
                    <i class="fas fa-users me-2"></i> Manage Members
                </a>
                <a class="nav-link" th:href="@{/admin/users/new}">
                    <i class="fas fa-user-plus me-2"></i> Add Member
                </a>
            </nav>
        </div>
        <div class="mt-auto p-4 border-top">
            <nav class="nav flex-column">
                <a class="nav-link" th:href="@{/settings}">
                    <i class="fas fa-cog me-2"></i> Settings
                </a>
                <a class="nav-link text-danger" th:href="@{/logout}">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </a>
            </nav>
        </div>
    </aside>

    <main class="flex-grow-1 overflow-auto">
        <div class="container py-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 th:text="${title}">Add/Edit Member</h4>
            </div>

            <!-- Success/Error Messages -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${success}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <form th:action="@{/admin/users/save}" th:object="${user}" method="post" class="row g-4">

                        <!-- Hidden ID for edit mode -->
                        <input type="hidden" th:field="*{id}"/>

                        <!-- Full Name -->
                        <div class="col-md-6">
                            <label class="form-label">Full Name *</label>
                            <input type="text" class="form-control" th:field="*{fullName}" required/>
                            <div class="text-danger mt-1" th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}"></div>
                        </div>

                        <!-- Username -->
                        <div class="col-md-6">
                            <label class="form-label">Username *</label>
                            <input type="text" class="form-control" th:field="*{username}" required/>
                            <div class="text-danger mt-1" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
                        </div>

                        <!-- Email -->
                        <div class="col-md-6">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-control" th:field="*{email}" required/>
                            <div class="text-danger mt-1" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                        </div>

                        <!-- Password fields - only shown when adding a new member -->
<div th:if="${user.id == null}" class="col-md-6">
    <label class="form-label">Password *</label>
    <input type="password" 
           class="form-control" 
           th:field="*{password}" 
           required />
    <div class="text-danger mt-1" 
         th:if="${#fields.hasErrors('password')}" 
         th:errors="*{password}">Password error</div>
</div>

<div th:if="${user.id == null}" class="col-md-6">
    <label class="form-label">Confirm Password *</label>
    <input type="password" 
           class="form-control" 
           name="confirmPassword" 
           required />
    
    <!-- Show error only if passwords don't match (set from controller) -->
    <div class="text-danger mt-1" th:if="${passwordMismatch}" th:text="${passwordMismatch}">
        Passwords do not match
    </div>
</div>

<!-- Optional message when editing -->
<div th:if="${user.id != null}" class="col-12 mb-3">
    <small class="text-muted">
        To change the password, use the "Change Password" feature (or leave blank to keep current).
    </small>
</div>

                        <!-- Submit Buttons -->
                        <div class="col-12 mt-5">
                            <button type="submit" class="btn btn-success px-5">Save Member</button>
                            <a th:href="@{/admin/users}" class="btn btn-secondary ms-3 px-5">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>